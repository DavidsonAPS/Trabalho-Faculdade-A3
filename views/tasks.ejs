<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minhas Tarefas - To-Do List</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f7f6; color: #333; margin:0; padding:0; line-height:1.6; }
        .container { max-width:900px; margin:20px auto; padding:20px; background:#fff; border-radius:8px; box-shadow:0 0 15px rgba(0,0,0,0.1);}
        h1,h2 { text-align:center; color:#007bff; margin-bottom:20px;}
        .alert { padding:10px 15px; border-radius:5px; margin-bottom:20px; text-align:center;}
        .alert-success { background:#d4edda; color:#155724; border:1px solid #c3e6cb;}
        .alert-danger { background:#f8d7da; color:#721c24; border:1px solid #f5c6cb;}

        .add-task-form, .filter-sort-container { background:#e9f5ff; padding:20px; border-radius:8px; margin-bottom:30px; border:1px solid #cceeff; }
        .add-task-form .form-group, .filter-sort-form .form-group { margin-bottom:15px;}
        label { font-weight:bold; color:#444; display:block; margin-bottom:5px;}
        input, textarea, select { width:100%; padding:10px; border:1px solid #a0cbed; border-radius:4px; background:#f0f8ff; color:#333; box-sizing:border-box;}
        textarea { min-height:80px; resize:vertical;}
        button { padding:10px; border:none; border-radius:5px; cursor:pointer; color:#fff; background:#007bff; width:100%; margin-top:10px; transition:0.3s;}
        button:hover { background:#0056b3;}

        .task-list { list-style:none; padding:0;}
        .task-item { background:#f9f9f9; border:1px solid #ddd; border-radius:5px; margin-bottom:10px; padding:15px; display:flex; justify-content:space-between; flex-wrap:wrap; transition:0.3s; }
        .task-item.completed { background:#e6ffe6; border-color:#a3e3a3; text-decoration:line-through; color:#666;}
        .task-title { font-weight:bold; font-size:1.1em; color:#333;}
        .task-item.completed .task-title { color:#555; }
        .task-meta { font-size:0.9em; color:#777; margin-top:5px;}
        .task-actions { display:flex; gap:10px; margin-top:10px; flex-wrap:wrap;}
        .edit-btn { background:#ffc107; color:#333; }
        .edit-btn:hover { background:#e0a800; }
        .delete-btn { background:#dc3545; color:#fff; }
        .delete-btn:hover { background:#c82333; }
        .toggle-complete-btn.pending { background:#ff8c00; }
        .toggle-complete-btn.pending:hover { background:#cc7000; }
        .toggle-complete-btn.completed { background:#28a745; }
        .toggle-complete-btn.completed:hover { background:#218838; }

        .statistics-button { display:inline-block; padding:10px 20px; background:#28a745; color:#fff; text-decoration:none; border-radius:5px; font-weight:bold; margin-bottom:25px; }
        .statistics-button:hover { background:#218838; }

        .notifications-section { background:#fff3cd; border:1px solid #ffeeba; border-radius:8px; padding:20px; margin-bottom:30px;}
        .notifications-section h2 { color:#856404; margin-top:0; margin-bottom:15px; text-align:center; }
        .notifications-section ul { list-style:none; padding:0;}
        .notifications-section li { background:#fff9e6; border:1px solid #ffecb5; border-radius:5px; padding:10px 15px; margin-bottom:8px; display:flex; justify-content:space-between; align-items:center; font-size:0.95em;}
        .notifications-section li .due-date { font-weight:bold; color:#dc3545;}

        .footer { text-align:center; margin-top:40px; padding-top:20px; border-top:1px solid #eee; }
    </style>
</head>
<body>
<div class="container">
    <h1>Bem-vindo, <%= user.username %>!</h1>

    <div style="text-align:center; margin-bottom:25px;">
        <a href="/tasks/statistics" class="statistics-button">Ver Estat√≠sticas de Produtividade</a>
    </div>

    <% if(message){ %><div class="alert alert-success"><%= message %></div><% } %>
    <% if(error){ %><div class="alert alert-danger"><%= error %></div><% } %>

    <% if(upcomingDueTasks && upcomingDueTasks.length>0){ %>
    <div class="notifications-section">
        <h2>üîî Tarefas Pr√≥ximas do Vencimento</h2>
        <ul>
            <% upcomingDueTasks.forEach(task=>{ %>
                <li>
                    <strong><%= task.title %></strong>
                    <span class="due-date"><%= task.due_date ? new Date(task.due_date).toLocaleDateString('pt-BR') : 'Vence em breve' %></span>
                </li>
            <% }) %>
        </ul>
    </div>
    <% } %>

    <div class="add-task-form">
        <h2>Adicionar Nova Tarefa</h2>
        <form action="/tasks/add" method="POST">
            <div class="form-group"><label>T√≠tulo:</label><input type="text" name="title" required></div>
            <div class="form-group"><label>Descri√ß√£o:</label><textarea name="description"></textarea></div>
            <div class="form-group"><label>Prioridade:</label>
                <select name="priority">
                    <option value="Baixa">Baixa</option>
                    <option value="M√©dia">M√©dia</option>
                    <option value="Alta">Alta</option>
                </select>
            </div>
            <div class="form-group"><label>Categoria:</label><input type="text" name="category"></div>
            <div class="form-group"><label>Prazo de Conclus√£o:</label><input type="date" name="due_date"></div>
            <button type="submit">Adicionar Tarefa</button>
        </form>
    </div>

    <h2>Minhas Tarefas</h2>
    <% if(tasks.length>0){ %>
    <ul class="task-list">
        <% tasks.forEach(task=>{ %>
            <li class="task-item <%= task.completed ? 'completed' : '' %>">
                <div>
                    <h3 class="task-title"><%= task.title %></h3>
                    <p><%= task.description %></p>
                    <div class="task-meta">
                        <p><strong>Prioridade:</strong> <%= task.priority %></p>
                        <p><strong>Categoria:</strong> <%= task.category %></p>
                        <% if(task.due_date){ %><p><strong>Prazo:</strong> <%= new Date(task.due_date).toLocaleDateString('pt-BR') %></p><% } %>
                        <p><strong>Criada em:</strong> <%= new Date(task.created_at).toLocaleDateString('pt-BR') %></p>
                    </div>
                </div>
                <div class="task-actions">
                    <form action="/tasks/edit/<%= task.id %>" method="GET"><button class="edit-btn">Editar</button></form>
                    <form action="/tasks/delete/<%= task.id %>" method="POST" onsubmit="return confirm('Deseja realmente excluir?');"><button class="delete-btn">Excluir</button></form>
                    <form action="/tasks/toggle-complete/<%= task.id %>" method="POST">
                        <button class="toggle-complete-btn <%= task.completed ? 'completed' : 'pending' %>">
                            <%= task.completed ? 'Marcar como Pendente' : 'Marcar como Conclu√≠da' %>
                        </button>
                    </form>
                </div>
            </li>
        <% }) %>
    </ul>
    <% } else { %>
        <p style="text-align:center;">Nenhuma tarefa encontrada.</p>
    <% } %>

    <div class="footer">
        <form action="/auth/logout" method="POST"><button class="logout-btn">Sair</button></form>
    </div>
</div>
</body>
</html>
